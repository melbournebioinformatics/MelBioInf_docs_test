<!doctype html><html lang="en" class="no-js"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="lang:clipboard.copy" content="Copy to clipboard"><meta name="lang:clipboard.copied" content="Copied to clipboard"><meta name="lang:search.language" content="en"><meta name="lang:search.pipeline.stopwords" content="True"><meta name="lang:search.pipeline.trimmer" content="True"><meta name="lang:search.result.none" content="No matching documents"><meta name="lang:search.result.one" content="1 matching document"><meta name="lang:search.result.other" content="# matching documents"><meta name="lang:search.tokenizer" content="[\s\-]+"><link rel="shortcut icon" href="../../../assets/images/favicon.png"><meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.3.1"><title>Alignment - Bioinformatics Documentation</title><link rel="stylesheet" href="../../../assets/stylesheets/application.4031d38b.css"><script src="../../../assets/javascripts/modernizr.74668098.js"></script><link href="https://fonts.gstatic.com" rel="preconnect" crossorigin><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=swap"><style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel="stylesheet" href="../../../assets/fonts/material-icons.css"><link rel="stylesheet" href="../../../extra.css"><script>window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-21794901-5", "www.melbournebioinformatics.org.au/tutorials/")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })</script><script async src="https://www.google-analytics.com/analytics.js"></script></head><body dir="ltr"><svg class="md-svg"><defs><svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg></defs></svg> <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off"> <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off"> <label class="md-overlay" data-md-component="overlay" for="__drawer"></label><a href="#alignment-tutorial" tabindex="1" class="md-skip">Skip to content </a><header class="md-header" data-md-component="header"><nav class="md-header-nav md-grid"><div class="md-flex"><div class="md-flex__cell md-flex__cell--shrink"><a href="../../.." title="Bioinformatics Documentation" class="md-header-nav__button md-logo"><i class="md-icon"></i></a></div><div class="md-flex__cell md-flex__cell--shrink"><label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label></div><div class="md-flex__cell md-flex__cell--stretch"><div class="md-flex__ellipsis md-header-nav__title" data-md-component="title"><span class="md-header-nav__topic">Bioinformatics Documentation</span><span class="md-header-nav__topic">Alignment</span></div></div><div class="md-flex__cell md-flex__cell--shrink"><label class="md-icon md-icon--search md-header-nav__button" for="__search"></label><div class="md-search" data-md-component="search" role="dialog"><label class="md-search__overlay" for="__search"></label><div class="md-search__inner" role="search"><form class="md-search__form" name="search"><input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active"> <label class="md-icon md-search__icon" for="__search"></label> <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button></form><div class="md-search__output"><div class="md-search__scrollwrap" data-md-scrollfix><div class="md-search-result" data-md-component="result"><div class="md-search-result__meta">Type to start searching</div><ol class="md-search-result__list"></ol></div></div></div></div></div></div><div class="md-flex__cell md-flex__cell--shrink"><div class="md-header-nav__source"><a href="https://github.com/melbournebioinformatics/MelBioInf_docs/" title="Go to repository" class="md-source" data-md-source="github"><div class="md-source__icon"><svg viewBox="0 0 24 24" width="24" height="24"><use xlink:href="#__github" width="24" height="24"></use></svg></div><div class="md-source__repository">melbournebioinformatics/MelBioInf_docs</div></a></div></div></div></nav></header><div class="md-container"><main class="md-main"><div class="md-main__inner md-grid" data-md-component="container"><div class="md-sidebar md-sidebar--primary" data-md-component="navigation"><div class="md-sidebar__scrollwrap"><div class="md-sidebar__inner"><nav class="md-nav md-nav--primary" data-md-level="0"><label class="md-nav__title md-nav__title--site" for="__drawer"><a href="../../.." title="Bioinformatics Documentation" class="md-nav__button md-logo"><i class="md-icon"></i></a>Bioinformatics Documentation</label><div class="md-nav__source"><a href="https://github.com/melbournebioinformatics/MelBioInf_docs/" title="Go to repository" class="md-source" data-md-source="github"><div class="md-source__icon"><svg viewBox="0 0 24 24" width="24" height="24"><use xlink:href="#__github" width="24" height="24"></use></svg></div><div class="md-source__repository">melbournebioinformatics/MelBioInf_docs</div></a></div><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../.." title="Home" class="md-nav__link">Home</a></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2"><label class="md-nav__link" for="nav-2">Guides</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-2">Guides</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../../guides/bioinfo/" title="What is bioinformatics?" class="md-nav__link">What is bioinformatics?</a></li><li class="md-nav__item"><a href="../../../guides/galaxy/" title="The Galaxy platform" class="md-nav__link">The Galaxy platform</a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3"><label class="md-nav__link" for="nav-3">General Tutorials</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-3">General Tutorials</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../python_overview/python_overview/" title="Python Overview" class="md-nav__link">Python Overview</a></li><li class="md-nav__item"><a href="../../python_pandas_tidy_data/python_pandas_tidy_data/" title="Data tidying with Python and Pandas" class="md-nav__link">Data tidying with Python and Pandas</a></li><li class="md-nav__item"><a href="../../python_viz/python_viz/" title="Data visualisation with Python" class="md-nav__link">Data visualisation with Python</a></li><li class="md-nav__item"><a href="../../using_git/Using_Git/" title="Using Git and Github for revision control" class="md-nav__link">Using Git and Github for revision control</a></li><li class="md-nav__item"><a href="../../hpc/hpc/" title="Introduction to HPC" class="md-nav__link">Introduction to HPC</a></li><li class="md-nav__item"><a href="../../unix/unix/" title="Introduction to Unix" class="md-nav__link">Introduction to Unix</a></li><li class="md-nav__item"><a href="../../gvl_launch/gvl_launch/" title="Launching a Personal GVL Server" class="md-nav__link">Launching a Personal GVL Server</a></li><li class="md-nav__item"><a href="../../galaxy_101/galaxy_101/" title="Introduction to Galaxy" class="md-nav__link">Introduction to Galaxy</a></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-9" type="checkbox" id="nav-3-9"><label class="md-nav__link" for="nav-3-9">Galaxy Workflows</label><nav class="md-nav" data-md-component="collapsible" data-md-level="2"><label class="md-nav__title" for="nav-3-9">Galaxy Workflows</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../galaxy-workflows/galaxy-workflows/" title="Tutorial" class="md-nav__link">Tutorial</a></li><li class="md-nav__item"><a href="../../galaxy-workflows/history_creation/" title="History Creation" class="md-nav__link">History Creation</a></li></ul></nav></li><li class="md-nav__item"><a href="../../docker/docker/" title="Containerized Bioinformatics" class="md-nav__link">Containerized Bioinformatics</a></li><li class="md-nav__item"><a href="../../cwl/cwl/" title="Common Workflow Language for Bioinformatics" class="md-nav__link">Common Workflow Language for Bioinformatics</a></li><li class="md-nav__item"><a href="../../bionitio/bionitio/" title="Command-line software development" class="md-nav__link">Command-line software development</a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4"><label class="md-nav__link" for="nav-4">Genomics Tutorials</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-4">Genomics Tutorials</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../variant_calling_galaxy_1/variant_calling_galaxy_1/" title="Introduction to Variant Calling" class="md-nav__link">Introduction to Variant Calling</a></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-2" type="checkbox" id="nav-4-2"><label class="md-nav__link" for="nav-4-2">Variant Calling Advanced</label><nav class="md-nav" data-md-component="collapsible" data-md-level="2"><label class="md-nav__title" for="nav-4-2">Variant Calling Advanced</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../var_detect_advanced/var_detect_advanced/" title="Tutorial" class="md-nav__link">Tutorial</a></li><li class="md-nav__item"><a href="../../var_detect_advanced/var_detect_advanced_background/" title="Background" class="md-nav__link">Background</a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-3" type="checkbox" id="nav-4-3"><label class="md-nav__link" for="nav-4-3">RNA-seq DGE Basic</label><nav class="md-nav" data-md-component="collapsible" data-md-level="2"><label class="md-nav__title" for="nav-4-3">RNA-seq DGE Basic</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../rna_seq_dge_basic/rna_seq_basic_tutorial/" title="Tutorial" class="md-nav__link">Tutorial</a></li><li class="md-nav__item"><a href="../../rna_seq_dge_basic/rna_seq_basic_tuxedo/" title="Tuxedo Protocol Tutorial" class="md-nav__link">Tuxedo Protocol Tutorial</a></li><li class="md-nav__item"><a href="../../rna_seq_dge_basic/rna_seq_basic_background/" title="Background" class="md-nav__link">Background</a></li></ul></nav></li><li class="md-nav__item"><a href="../../rna_seq_dge_advanced/rna_seq_advanced_tutorial/" title="RNA-seq DGE Advanced" class="md-nav__link">RNA-seq DGE Advanced</a></li><li class="md-nav__item"><a href="../../rna_seq_exp_design/rna_seq_experimental_design/" title="RNA-seq DGE Experimental Design" class="md-nav__link">RNA-seq DGE Experimental Design</a></li><li class="md-nav__item"><a href="../../singlecell/" title="10X single-cell RNA-seq analysis in R" class="md-nav__link">10X single-cell RNA-seq analysis in R</a></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-7" type="checkbox" id="nav-4-7"><label class="md-nav__link" for="nav-4-7">Microbial de novo Assembly for Illumina Data: Velvet</label><nav class="md-nav" data-md-component="collapsible" data-md-level="2"><label class="md-nav__title" for="nav-4-7">Microbial de novo Assembly for Illumina Data: Velvet</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../assembly/assembly/" title="Tutorial" class="md-nav__link">Tutorial</a></li><li class="md-nav__item"><a href="../../assembly/assembly-background/" title="Method Background" class="md-nav__link">Method Background</a></li></ul></nav></li><li class="md-nav__item"><a href="../../assembly/spades/" title="Microbial assembly: Spades" class="md-nav__link">Microbial assembly: Spades</a></li><li class="md-nav__item"><a href="../../pacbio/" title="Long read assembly" class="md-nav__link">Long read assembly</a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5"><label class="md-nav__link" for="nav-5">Proteomics Tutorials</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-5">Proteomics Tutorials</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-1" type="checkbox" id="nav-5-1"><label class="md-nav__link" for="nav-5-1">Identifying proteins from mass spectrometry data</label><nav class="md-nav" data-md-component="collapsible" data-md-level="2"><label class="md-nav__title" for="nav-5-1">Identifying proteins from mass spectrometry data</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../proteomics_basic/proteomics_basic/" title="Tutorial" class="md-nav__link">Tutorial</a></li><li class="md-nav__item"><a href="../../proteomics_basic/background_galaxy/" title="Galaxy Background" class="md-nav__link">Galaxy Background</a></li><li class="md-nav__item"><a href="../../proteomics_basic/background_data_formats/" title="Data Formats Background" class="md-nav__link">Data Formats Background</a></li><li class="md-nav__item"><a href="../../proteomics_basic/background_findcountitems_workflow/" title="Create find count items workflow" class="md-nav__link">Create find count items workflow</a></li><li class="md-nav__item"><a href="../../proteomics_basic/background_protein_databases/" title="Protein Databases" class="md-nav__link">Protein Databases</a></li><li class="md-nav__item"><a href="../../proteomics_basic/background_search_engines/" title="Search Engines" class="md-nav__link">Search Engines</a></li><li class="md-nav__item"><a href="../../proteomics_basic/background_protein_prophet/" title="Protein Prophet" class="md-nav__link">Protein Prophet</a></li></ul></nav></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6"><label class="md-nav__link" for="nav-6">Molecular Modelling Tutorials</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-6">Molecular Modelling Tutorials</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../molecular_dynamics_101/molecular_dynamics_101/" title="Molecular Dynamics - Introduction to cluster computing" class="md-nav__link">Molecular Dynamics - Introduction to cluster computing</a></li><li class="md-nav__item"><a href="../../molecular_dynamics_201/molecular_dynamics_201/" title="Molecular Dynamics - Building input files, visualising the trajectory" class="md-nav__link">Molecular Dynamics - Building input files, visualising the trajectory</a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7"><label class="md-nav__link" for="nav-7">Protocols</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-7">Protocols</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../assembly/assembly-protocol/" title="De Novo Genome Assembly for Illumina Data" class="md-nav__link">De Novo Genome Assembly for Illumina Data</a></li></ul></nav></li></ul></nav></div></div></div><div class="md-sidebar md-sidebar--secondary" data-md-component="toc"><div class="md-sidebar__scrollwrap"><div class="md-sidebar__inner"><nav class="md-nav md-nav--secondary"><label class="md-nav__title" for="__toc">Table of contents</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="#section-1-alignment-using-galaxy" title="Section 1: Alignment using Galaxy" class="md-nav__link">Section 1: Alignment using Galaxy</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#preparation" title="Preparation" class="md-nav__link">Preparation</a></li><li class="md-nav__item"><a href="#alignment" title="Alignment" class="md-nav__link">Alignment</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#run-bwa" title="Run BWA" class="md-nav__link">Run BWA</a></li></ul></nav></li></ul></nav></li><li class="md-nav__item"><a href="#section-2-view-the-alignment" title="Section 2: View the alignment" class="md-nav__link">Section 2: View the alignment</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#load-the-vnc-interface" title="Load the VNC interface" class="md-nav__link">Load the VNC interface</a></li><li class="md-nav__item"><a href="#download-the-data" title="Download the data" class="md-nav__link">Download the data</a></li><li class="md-nav__item"><a href="#view-the-bam-file-in-igv" title="View the BAM file in IGV" class="md-nav__link">View the BAM file in IGV</a></li></ul></nav></li><li class="md-nav__item"><a href="#section-3-alignment-using-the-command-line" title="Section 3: Alignment using the command line" class="md-nav__link">Section 3: Alignment using the command line</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#get-the-data" title="Get the data" class="md-nav__link">Get the data</a></li><li class="md-nav__item"><a href="#set-up-the-environment" title="Set up the environment" class="md-nav__link">Set up the environment</a></li><li class="md-nav__item"><a href="#perform-the-alignment" title="Perform the alignment" class="md-nav__link">Perform the alignment</a></li><li class="md-nav__item"><a href="#make-the-bam-file" title="Make the BAM file" class="md-nav__link">Make the BAM file</a></li><li class="md-nav__item"><a href="#other-sam-tools-commands" title="Other SAM tools commands" class="md-nav__link">Other SAM tools commands</a></li></ul></nav></li></ul></nav></div></div></div><div class="md-content"><article class="md-content__inner md-typeset"><a href="https://github.com/melbournebioinformatics/MelBioInf_docs/edit/master/docs/tutorials/alignment/alignment.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a><style>

</style>

<div class="image-header-gvl">
    <a href=http://genome.edu.au><img src="../media/gvl_logo.jpg" alt="GVL logo" width="112"/></a>
    <a href="http://galaxyproject.org"><img src="../media/GalaxyLogoHighRes.png" width="164" /></a>
    <a href="https://www.melbournebioinformatics.org.au/"><img src="../../../img/melbioinf_logo.png" alt="Melbourne Bioinformatics logo" width="164"/></a>
</div>

<h1 id="alignment-tutorial">Alignment Tutorial</h1>
<p>In this tutorial we will be performing some alignments of short reads to a longer reference (as outlined in earlier lectures.) It is split into two sections. You will perform the same analysis in both sections. The first is Alignment using the Galaxy bioinformatics workflow environment, the second is Alignment using the Unix/Linux command line. Both sections use the same tools.</p>
<p>We'll be using some data and steps from the Genomics Virtual Lab Variant Detection tutorials. You can follow these links if interested to see the full <a href="../variant_calling_galaxy_1/variant_calling_galaxy_1/">Introductory Variant Detection</a> and <a href="../var_detect_advanced/var_detect_advanced/">Advanced Variant Detection</a> tutorials.</p>
<h2 id="section-1-alignment-using-galaxy">Section 1: Alignment using Galaxy</h2>
<h3 id="preparation">Preparation</h3>
<ol>
<li>
<p>Open Galaxy using the IP address of your Cloud instance in Firefox or Chrome (whichever)</p>
<ul>
<li>Unless you already have, create a log-in for yourself</li>
<li>On the top menu select: <strong>User -&gt; Register</strong><ul>
<li>Enter your email address, choose a password, repeat it and add an (all lower case) one word name</li>
<li>Click Submit.</li>
</ul>
</li>
<li>If you have already registered previously, just log in.</li>
</ul>
</li>
<li>
<p>Create a new history and load the required data files</p>
<ul>
<li>Click the <img src="../media/Galaxy-menu.png" width=20 /> icon in the History pane and <strong>Create New</strong>.</li>
</ul>
</li>
<li>
<p>There's only one input file, so instead of importing a History, let's import the file directly:</p>
<ul>
<li>
<p>From the tool panel, click on <strong>Get Data -&gt; Upload File</strong></p>
<ul>
<li>Click on the <strong>Paste/Fetch Data</strong> button</li>
<li>Copy and paste the following web address into the URL/Text box:       <em>https://swift.rc.nectar.org.au:8888/v1/AUTH_377/public/variantCalling_BASIC/NA12878.GAIIx.exome_chr22.1E6reads.76bp.fastq</em></li>
<li>Set the file format to <em>fastqsanger</em> (not fastqcsanger)</li>
<li>Click <strong>Start</strong><ul>
<li>Once the progress bar has reached 100%, click <strong>Close</strong></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Once the file is imported, you may want to give it a shorter name by clicking the <img src="../media/Galaxy-edit.png" width=20 /> icon on the dataset in the History pane.</p>
</li>
<li>
<p>Examine the input data.</p>
<ul>
<li>In the History pane on the right, you should see a FASTQ file in the History. Click the <img src="../media/Galaxy-view.png" width=20 /> icon to view the contents.</li>
</ul>
</li>
</ol>
<p>The data for this workshop is the same as that used in the GVL Introductory Variant Detection tutorial. It is short read data from the exome of chromosome 22 of a single human individual. There are one million 76bp reads in the dataset, produced on an Illumina GAIIx from exome-enriched DNA. This data was generated as part of the 1000 Genomes project: <a href="http://www.1000genomes.org/">http://www.1000genomes.org/</a>.</p>
<h3 id="alignment">Alignment</h3>
<h4 id="run-bwa">Run BWA</h4>
<p>For our alignment, we will use the tool BWA, which stands for "Burrows-Wheeler Aligner". You can see its website, if interested, at <a href="http://bio-bwa.sourceforge.net/">http://bio-bwa.sourceforge.net/</a>. We will be using the bwa mem variant.</p>
<p>Hopefully, everything will be working fine, so the first thing we need to do is run BWA.. To do this, use the following steps.</p>
<ol>
<li>
<p>In the Galaxy tool pane on the left, under <strong>NGS: Mapping</strong> select the tool <strong>Map with BWA-MEM</strong>.</p>
<ul>
<li>We want to align this data to the human genome. Have a look under <strong>Using reference genome</strong>. Choose <em>hg19</em>. This is Human reference genome 19 (<a href="http://genome.ucsc.edu/cgi-bin/hgTracks?db=hg38&amp;position=chr9%3A133252000-133280861&amp;hgsid=469994169_9o1YboOfEP0gNexrwy41qevQrTdZ">UCSC hg19</a>).</li>
<li>Set <strong>Single or Paired-end reads</strong> to <em>Single</em></li>
<li>Specify the FASTQ file as input - it may be automatically selected already.</li>
<li>For our alignment, it will be ok to use the default alignment parameters. However, have a look at the options you can change by setting <strong>Select analysis mode</strong> to <em>Full list of options</em>. Look through the parameters and see if you understand from lectures what they are for. You can also read documentation on these options by scrolling down the Galaxy BWA tool page.</li>
<li>Put the <strong>Select analysis mode</strong> back to <em>Simple Illumina Mode</em></li>
<li>Click <strong>Execute</strong> and wait for your job to run.</li>
</ul>
</li>
</ol>
<p>This may take a few minutes and will produce a BAM file. While waiting you can have a look at the SAM/BAM format specification. Look at <a href="https://docs.google.com/document/pub?id=1fouC29Lq0CXxQQCpuojrR5RXbdzMdxRf8ZID01XYNqI#h.18e90b8fc68f">this document</a>, which gives you information on FASTQ, SAM, pileup and BED formats. You can also view the SAM/BAM format specification itself at <a href="http://samtools.github.io/hts-specs/SAMv1.pdf">http://samtools.github.io/hts-specs/SAMv1.pdf</a>.</p>
<p>Now we will convert the compressed BAM file to an uncompressed SAM file so we can see what it looks like.</p>
<ol>
<li>
<p>In the Galaxy tool pane on the left, under <strong>NGS: SAM tools</strong> select the tool <strong>BAM to SAM</strong>.</p>
<ul>
<li>For <strong>BAM File to Convert</strong> select your BAM file.</li>
<li>Click <strong>Execute</strong>.</li>
</ul>
</li>
</ol>
<p>Browse the resulting SAM file. To view the data click on the <img src="../media/Galaxy-view.png" width=20 /> icon next to the “BAM to SAM on … converted SAM” dataset in the History panel on the right-hand-side of the display. You should see header lines which begin with "@", followed by one alignment row per read. Refer to the docs above to understand what you're seeing.</p>
<p>One thing to notice is that the SAM file might be sorted in different ways, or might not be sorted at all. Two common ways of sorting a SAM or BAM file are:</p>
<ul>
<li>Alphabetically by the names of the reads. The read names are the first column of the SAM file, and come from the "&gt;" lines in the FASTQ file.</li>
<li>In order of genomic position, so that all the reads aligned to chromosome 1 are listed first (in coordinate order), followed by reads aligned to chromosome 2, etc. This information is in the third and fourth columns of the SAM file. This sort order is usually more useful for algorithms which need to access data that's aligned to a particular region of the genome.</li>
</ul>
<h2 id="section-2-view-the-alignment">Section 2: View the alignment</h2>
<h3 id="load-the-vnc-interface">Load the VNC interface</h3>
<p>We will use a Genome Browser called IGV to view the BAM alignment. It is installed on your cloud computer. To use it, we need to log in to your cloud computer's VNC interface.</p>
<ol>
<li>Point your web browser at <em>http://your-ip-address</em></li>
<li>This is the GVL dashboard. Half way down the page there is a link to the Lubuntu desktop. It is, <em>http://your-ip-address/vnc</em>, click on it.</li>
<li>You'll need to log in to the web page using the username: <em>Ubuntu</em>, password: <em>SummerCamp2016</em>. This will display the desktop of the cloud computer in your web browser. (You may need to reload the page for it to work properly.)</li>
<li>Login to the desktop as the <em>researcher</em> user (not ubuntu) using the same password.</li>
</ol>
<p>Now we have logged into the cloud computer's visual desktop. You'll notice two icons on the desktop. A terminal and a shortcut to IGV.</p>
<h3 id="download-the-data">Download the data</h3>
<p>The next thing we need to do is get the BAM files out of Galaxy and into the normal unix filesystem. To do this we need to load Galaxy within the VNC interface.</p>
<ol>
<li>From the Linux menu button on the bottom left of the vnc interface, select <strong>Internet-&gt;Firefox</strong></li>
<li>Point the resultant web browser (within the VNC interface) at <em>http://localhost/galaxy</em></li>
<li>Login to this Galaxy interface via the <strong>User</strong> menu using the same login details you set up earlier. You should now see the history that you hve been working on.</li>
<li>Click on the file name of the BAM file in your history. This will expand it to show some additional details.</li>
<li>Click on the Download (<img src="../media/Galaxy-download.png" width=20 />) button. You'll need to download both the BAM file and BAM index file.</li>
</ol>
<h3 id="view-the-bam-file-in-igv">View the BAM file in IGV</h3>
<p>Now we will open IGV to view the bam file and browse the alignment.</p>
<ol>
<li>Double click the IGV icon on the VNC desktop. Note that it will take some time to open.</li>
<li>We need to make sure we have the correct reference genome loaded that matches the one we used in our alignment. Make sure that the dropdown box on the top-left shows hg19.</li>
<li>Load the BAM you downloaded from Galaxy. Select <strong>File -&gt; Load from File</strong> and supply the BAM file. (It is in the researcher user's Downloads directory.)</li>
</ol>
<p>Now explore the visualisation of the BAM file!</p>
<p>Recall that our example data is from chromosome 22 only. In the contig drop-down menu, which says "All", instead select "22". Zoom in. If you're still having trouble finding the area the reads are mapped to, paste these coordinates into the box in the top bar of IGV: 22:17,432,499-17,502,283 . Then click "Go".</p>
<p>At the bottom, you should see an annotation track that is loaded into IGV by default, showing transcripts. Right click on the “Genes” track and select “Expanded”.</p>
<p>Zoom in to look at individual reads. Compare them to the gene annotation track, do you understand what is going on? Try zooming in far enough to see the reference genome sequence. Browse around and see if you can find some errors in the alignments. You can also explore IGV's features - try right-clicking on a read to change the display options.</p>
<h2 id="section-3-alignment-using-the-command-line">Section 3: Alignment using the command line</h2>
<p>In this section of the tutorial we will perform the same alignment as before on the command line. We will use the same data and tools.</p>
<p>To use the command-line on your Research Cloud instance, ssh in to your instance as researcher@<your-ip-address> using ssh or Putty.</p>
<h3 id="get-the-data">Get the data</h3>
<p>Once you are in the unix shell, you can get the input data for the tutorial using a command like <code>wget</code> or <code>curl</code>:</p>
<pre><code>wget https://swift.rc.nectar.org.au:8888/v1/AUTH_377/public/variantCalling_BASIC/NA12878.GAIIx.exome_chr22.1E6reads.76bp.fastq
</code></pre>
<p>This will download the datafile to the current directory.</p>
<h3 id="set-up-the-environment">Set up the environment</h3>
<p>Now you'll need to load the <em>bwa</em> and <em>samtools</em> modules. Try</p>
<pre><code>module avail
</code></pre>
<p>This command will show you a list of command line tool modules available to you. To use any of the tools, you need to load them into the current compute environment. You use the <code>module load</code> command for this. We need bwa and samtools so the commands are:</p>
<pre><code>module load bwa
module load samtools/1.2
</code></pre>
<p>Then, run bwa with the command: <code>bwa</code> to see some information on BWA usage. This will list BWA commands, such as <em>bwa index</em>, which indexes a reference genome, and <em>bwa mem</em>, which performs alignment. Type a command to see information on its usage. Try <code>bwa mem</code> to see how to run <em>bwa mem</em>.</p>
<p>Similarly, try just <code>samtools</code> to see a list of samtools commands.</p>
<h3 id="perform-the-alignment">Perform the alignment</h3>
<p>The Galaxy BWA tool actually wraps three commands; <em>bwa mem</em>, which performs alignment and produces a SAM file; <em>samtools view</em> which produces a BAM file from the SAM file and finally <em>samtools sort</em> which sorts the bam file so it is in reference position order.</p>
<p>We will replicate that process here.</p>
<p>How can you get an indexed reference genome? You could download a FASTA file and index it with <code>bwa index</code>. The human genome is fairly large and we won't have time to index it during the lab, but your instance should already have access to an indexed genome. Try</p>
<pre><code>ls galaxy_genomes
ls galaxy_genomes/hg19
ls galaxy_genomes/hg19/bwa_mem_index
ls galaxy_genomes/hg19/bwa_mem_index/hg19/
</code></pre>
<p>Under galaxy_genomes are directories for different reference genomes, and each has pre-built indices for various tools including BWA. You may also need galaxy_genomes/hg19/sam_index when using some samtools commands.</p>
<p>You need to give BWA the prefix of the reference genome index files, which is <em>galaxy_genomes/hg19/bwa_index/hg19/hg19.fa</em></p>
<p>So as the genome has already been indexed for us, we just need to point bwa at it.</p>
<p>So, now we can run bwa to align the reads to the reference.</p>
<p>We use the form of the command <em>bwa mem index_file reads_file &gt; aligned_reads.sam</em></p>
<p>To do this from your home directory, run the command:</p>
<pre><code>bwa mem galaxy_genomes/hg19/bwa_mem_index/hg19/hg19.fa NA12878.GAIIx.exome_chr22.1E6reads.76bp.fastq &gt; aligned_reads.sam
</code></pre>
<p>This will load the reference index, align the reads and produce a SAM file called <em>aligned_reads.sam</em>.</p>
<p>Use <code>less</code> to examine it.</p>
<h3 id="make-the-bam-file">Make the BAM file</h3>
<p>Try to convert your SAM file to a BAM file using samtools view. The command you'll need is:</p>
<pre><code>samtools view -b -h aligned_reads.sam &gt; aligned_reads.bam
</code></pre>
<p>You can look up the effect of all these command line flags by typing the view command by itself, or by reading the samtools documentation.</p>
<h3 id="other-sam-tools-commands">Other SAM tools commands</h3>
<p>Try some other samtools commands on your BAM file. Again, find out how to use them by typing them by themselves, or by reading the documentation. Some commands are:</p>
<ul>
<li><em>samtools sort</em> to sort the BAM file</li>
<li><em>samtools index</em> to produce the index (.bai) file. You need this to visualise the BAM file in IGV.</li>
<li><em>samtools flagstat</em> to get some basic information on mapped reads</li>
<li><em>samtools view</em> to see the BAM files contents; this effectively converts it back to SAM</li>
</ul>
<p>Now go back to the viewing BAM alignments section above. You'll need to sort the BAM file and create an index (.bai) file before you load the BAM file into IGV...</p>
<p>That's it, I hope you enjoyed the tutorial!</p></article></div></div></main><footer class="md-footer"><div class="md-footer-meta md-typeset"><div class="md-footer-meta__inner md-grid"><div class="md-footer-copyright"><div class="md-footer-copyright__highlight"><a href="https://www.melbournebioinformatics.org.au/">Melbourne Bioinformatics</a></div>powered by <a href="https://www.mkdocs.org">MkDocs</a> and <a href="https://squidfunk.github.io/mkdocs-material/">Material for MkDocs</a></div></div></div></footer></div><script src="../../../assets/javascripts/application.b260a35d.js"></script><script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script></body></html>